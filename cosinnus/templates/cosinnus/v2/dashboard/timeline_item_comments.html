{% load i18n cosinnus_tags %}

{% comment %} 
	This template is only meant to be loaded from inside a timeline item template,
	and from there inside the comments block, as such:
	{% block comments %}{% include 'cosinnus/v2/dashboard/timeline_item_comments.html' with item=item %}{% endblock %}
{% endcomment %}

<div class="timeline-item-comments">
	{% with comments=item.comments.all %}
		 {% with comment_count=comments|length %}
		 
			<hr class="seperator" />
			<div class="timeline-item-row comments-header text-small flex-row">
				<div class="flex-grow">
					<i class="fa fa-fw fa-comments"></i>
					<span class="comments-count">{{ comment_count }}</span>
				</div>
				<div class="plain-links pale-color">
					{% comment %} onclick functionality is in timeline-view.js {% endcomment %}
					{% if comment_count > 3 %}
						<a href="#" class="show-all-comments">
							{% blocktrans with count=comment_count %}Show all {{ count }} comments{% endblocktrans %}
						</a>
					{% endif %}
				</div>
			</div>
			
			{% for comment in comments %}
				<hr class="seperator {% if comment_count > 3 and forloop.counter <= comment_count|subtract:3 %}comment-hidden{% endif %}" />
				<div class="timeline-item-row comment {% if comment_count > 3 and forloop.counter <= comment_count|subtract:3 %}comment-hidden{% endif %}">
					<div class="comment-header text-small flex-row">
						<div class="avatar-small">
							<a href="{{ comment.creator|profile_url }}">
								{% include "cosinnus/user/user_avatar_image.html" with user=comment.creator %}
							</a>
						</div>
						<div class="comment-creator-label">
							<span>
								<a href="{{ comment.creator|profile_url }}">
									{{ comment.creator|full_name }}
								</a>
							</span>
							<span class="plain-links">
								<a href="{{ comment.get_absolute_url }}"><span class="annotation moment-data-date" data-date="{{ comment.created_on|date:'c' }}" ></span></a>
							</span>
						</div>
						<div class="comment-dropdown dropdown">
							{% comment %} TODO {% endcomment %}
						</div>	
					</div>
					<div class="comment-body v2-textfield ">
						{{ comment.text|textfield }}
					</div>
				</div>
			{% endfor %}
			
		{% endwith %}
	{% endwith %}
	
	<hr class="seperator" />
	<div class="timeline-item-row comment-form flex-row">
		<div class="">
			<i class="fa fa-fw fa-pencil"></i>
		</div>
		<div class="flex-grow">
			<form action="{{ item.get_comment_post_url }}" method="post">
                {% csrf_token %}
				<textarea id="id_text" name="text" type="text" placeholder="{% trans "Write comment..." %}"></textarea>
			</form>
		</div>
	</div>
</div>

